<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω GLOBUS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #0088cc;
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .product-info {
            padding: 15px;
        }
        .product-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 5px 0;
        }
        .product-price {
            color: #0088cc;
            font-weight: bold;
            font-size: 18px;
            margin: 5px 0;
        }
        .product-description {
            font-size: 14px;
            color: #666;
            margin: 5px 0 10px 0;
        }
        .product-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
        }
        .quantity-btn {
            width: 30px;
            height: 30px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .quantity-input {
            width: 40px;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }
        .add-to-cart {
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
        }
        .cart-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 100;
        }
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: red;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .cart-item-price {
            color: #0088cc;
        }
        .cart-item-remove {
            color: red;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
        }
        .cart-total {
            font-size: 18px;
            font-weight: bold;
            text-align: right;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .checkout-form {
            margin-top: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            min-height: 80px;
        }
        .submit-order {
            width: 100%;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .empty-cart {
            text-align: center;
            padding: 40px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            –ú–∞–≥–∞–∑–∏–Ω GLOBUS
        </header>
        
        <div class="product-list" id="productList">
            <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>
    
    <button class="cart-button" id="cartButton">
        üõí
        <span class="cart-count" id="cartCount">0</span>
    </button>
    
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <div id="cartItems">
                <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                <div class="empty-cart">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            </div>
            
            <div class="cart-total" id="cartTotal">
                –ò—Ç–æ–≥–æ: 0 —Ä—É–±.
            </div>
            
            <div class="checkout-form" id="checkoutForm" style="display: none;">
                <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
                <div class="form-group">
                    <label class="form-label" for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" class="form-input" id="phone" required placeholder="+7 (999) 123-45-67">
                </div>
                <div class="form-group">
                    <label class="form-label" for="address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <input type="text" class="form-input" id="address" required placeholder="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –∫–≤. 2">
                </div>
                <div class="form-group">
                    <label class="form-label" for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                    <textarea class="form-textarea" id="comment" placeholder="–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è"></textarea>
                </div>
                <button class="submit-order" id="submitOrder">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
            
            <button class="submit-order" id="proceedToCheckout" style="display: none;">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
        </div>
    </div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞)
        const products = {
            '1': {id: '1', name: '–ì–ª–æ–±—É—Å –ó–µ–º–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π', price: 2490, description: '–§–∏–∑–∏—á–µ—Å–∫–∏–π –≥–ª–æ–±—É—Å —Å —Ä–µ–ª—å–µ—Ñ–æ–º', image: 'https://via.placeholder.com/300x200?text=Globe+1'},
            '2': {id: '2', name: '–ì–ª–æ–±—É—Å –ó–µ–º–ª–∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π', price: 1990, description: '–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≥–ª–æ–±—É—Å —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å—Ç—Ä–∞–Ω', image: 'https://via.placeholder.com/300x200?text=Globe+2'},
            '3': {id: '3', name: '–ì–ª–æ–±—É—Å –õ—É–Ω—ã', price: 3490, description: '–ì–ª–æ–±—É—Å –õ—É–Ω—ã —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫—Ä–∞—Ç–µ—Ä–æ–≤', image: 'https://via.placeholder.com/300x200?text=Globe+3'},
            '4': {id: '4', name: '–ì–ª–æ–±—É—Å –ú–∞—Ä—Å–∞', price: 3790, description: '–ì–ª–æ–±—É—Å –ú–∞—Ä—Å–∞ —Å –º–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏', image: 'https://via.placeholder.com/300x200?text=Globe+4'},
            '5': {id: '5', name: '–ê–Ω—Ç–∏—á–Ω—ã–π –≥–ª–æ–±—É—Å', price: 4590, description: '–ì–ª–æ–±—É—Å –≤ –≤–∏–Ω—Ç–∞–∂–Ω–æ–º —Å—Ç–∏–ª–µ', image: 'https://via.placeholder.com/300x200?text=Globe+5'},
            '6': {id: '6', name: '–ì–ª–æ–±—É—Å –¥–ª—è –¥–µ—Ç–µ–π', price: 1590, description: '–Ø—Ä–∫–∏–π –≥–ª–æ–±—É—Å —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏', image: 'https://via.placeholder.com/300x200?text=Globe+6'},
        };
        
        // –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let cart = {};
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const productListEl = document.getElementById('productList');
        const cartButton = document.getElementById('cartButton');
        const cartCountEl = document.getElementById('cartCount');
        const cartModal = document.getElementById('cartModal');
        const closeModal = document.getElementById('closeModal');
        const cartItemsEl = document.getElementById('cartItems');
        const cartTotalEl = document.getElementById('cartTotal');
        const proceedToCheckout = document.getElementById('proceedToCheckout');
        const checkoutForm = document.getElementById('checkoutForm');
        const submitOrder = document.getElementById('submitOrder');
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage
        function loadCart() {
            const savedCart = localStorage.getItem('globus_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartCount();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –≤ localStorage
        function saveCart() {
            localStorage.setItem('globus_cart', JSON.stringify(cart));
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
        function updateCartCount() {
            let count = 0;
            for (const id in cart) {
                count += cart[id].quantity;
            }
            cartCountEl.textContent = count;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        function renderProducts() {
            productListEl.innerHTML = '';
            
            for (const id in products) {
                const product = products[id];
                const productEl = document.createElement('div');
                productEl.className = 'product-card';
                
                const inCart = cart[id] ? cart[id].quantity : 0;
                
                productEl.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">${product.price} —Ä—É–±.</div>
                        <p class="product-description">${product.description}</p>
                        <div class="product-actions">
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" data-id="${id}">-</button>
                                <input type="text" class="quantity-input" value="${inCart}" data-id="${id}" readonly>
                                <button class="quantity-btn plus" data-id="${id}">+</button>
                            </div>
                            <button class="add-to-cart" data-id="${id}">${inCart > 0 ? '–ò–∑–º–µ–Ω–∏—Ç—å' : '–í –∫–æ—Ä–∑–∏–Ω—É'}</button>
                        </div>
                    </div>
                `;
                
                productListEl.appendChild(productEl);
            }
            
            // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            document.querySelectorAll('.plus').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const input = document.querySelector(`.quantity-input[data-id="${id}"]`);
                    input.value = parseInt(input.value) + 1;
                });
            });
            
            document.querySelectorAll('.minus').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const input = document.querySelector(`.quantity-input[data-id="${id}"]`);
                    if (parseInt(input.value) > 0) {
                        input.value = parseInt(input.value) - 1;
                    }
                });
            });
            
            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const input = document.querySelector(`.quantity-input[data-id="${id}"]`);
                    const quantity = parseInt(input.value);
                    
                    if (quantity > 0) {
                        cart[id] = { product_id: id, quantity: quantity };
                        e.target.textContent = '–ò–∑–º–µ–Ω–∏—Ç—å';
                    } else {
                        delete cart[id];
                        e.target.textContent = '–í –∫–æ—Ä–∑–∏–Ω—É';
                    }
                    
                    saveCart();
                    updateCartCount();
                });
            });
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
        function renderCart() {
            const items = Object.values(cart);
            
            if (items.length === 0) {
                cartItemsEl.innerHTML = '<div class="empty-cart">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
                proceedToCheckout.style.display = 'none';
                checkoutForm.style.display = 'none';
            } else {
                cartItemsEl.innerHTML = '';
                let total = 0;
                
                items.forEach(item => {
                    const product = products[item.product_id];
                    total += product.price * item.quantity;
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    itemEl.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-title">${product.name}</div>
                            <div class="cart-item-price">${product.price} —Ä—É–±. x ${item.quantity} = ${product.price * item.quantity} —Ä—É–±.</div>
                        </div>
                        <button class="cart-item-remove" data-id="${item.product_id}">&times;</button>
                    `;
                    
                    cartItemsEl.appendChild(itemEl);
                });
                
                cartTotalEl.textContent = `–ò—Ç–æ–≥–æ: ${total} —Ä—É–±.`;
                proceedToCheckout.style.display = 'block';
                checkoutForm.style.display = 'none';
                
                // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
                document.querySelectorAll('.cart-item-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.target.getAttribute('data-id');
                        delete cart[id];
                        saveCart();
                        updateCartCount();
                        renderCart();
                        renderProducts();
                    });
                });
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞
        function submitOrderHandler() {
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const comment = document.getElementById('comment').value;
            
            if (!phone || !address) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (—Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∞–¥—Ä–µ—Å)');
                return;
            }
            
            const orderData = {
                type: 'order',
                phone: phone,
                address: address,
                comment: comment,
                items: Object.values(cart)
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
            tg.sendData(JSON.stringify(orderData));
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
            tg.close();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            loadCart();
            renderProducts();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            cartButton.addEventListener('click', () => {
                renderCart();
                cartModal.style.display = 'flex';
            });
            
            closeModal.addEventListener('click', () => {
                cartModal.style.display = 'none';
            });
            
            proceedToCheckout.addEventListener('click', () => {
                proceedToCheckout.style.display = 'none';
                checkoutForm.style.display = 'block';
            });
            
            submitOrder.addEventListener('click', submitOrderHandler);
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>